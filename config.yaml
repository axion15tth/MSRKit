project_name: "msrkit"
exp_name: "htdemucs_cunet_vocals"

# ---- global ----
sample_rate: 48000
chunk_sec: 10
peak_softlimit: 0.98
dc_hp_hz: 20.0

# ---- model ----
model:
  name: "HTDemucsCUNetGenerator"
  stems: ["vocals","guitars","bass","keyboards","synthesizers","drums","percussions","orchestral"]
  target: "vocals"

  stage1_htdemucs:
    base_channels: 64
    depth: 4
    stft_n_fft: 1024
    stft_hop: 256
    stft_win: 1024
    freq_ctx_channels: 128
    bottleneck_layers: 3
    mixture_consistency: true
    mc_mode: "uniform"

  stage2_cunet:
    depth: 5
    channels: [64,128,256,384,512]
    kernel_size: [3,3]
    stft:
      windows: [4096, 1024, 256]
      hops:    [1024, 256, 64]
    band_split_hz: [200, 2000, 8000]
    crm_mag_limit: [1.5, 2.0, 3.0, 4.0]
    use_mix_condition: true
    film:
      direction_dim: 10
      use_alpha_hf: false

  conditioning:
    alpha_mode: "estimator"            # ["estimator","manual","auto_candidates"]
    alpha_value: 1.0
    alpha_candidates: [0.6, 1.0, 1.4]
    direction_mode: "estimator"        # ["estimator","zero","manual"]
    direction_manual: null

# ---- degradation estimator ----
deg_estimator:
  alpha_min: 0.4
  alpha_max: 1.6
  third_octave: true
  use_hnr_proxy: false
  use_stem_stats: false

# ---- discriminators ----
discriminators:
  - name: "MultiFrequencyDiscriminator"
    params:
      nch: 1
      window_sizes: [2048, 1024, 512]
      sample_rate: 48000
      norm: true

# ---- data ----
data:
  sample_rate: 48000
  clip_duration: 10.0

  # ★ 推奨: FileList（各行: mix_path|target_path）
  #train_file_list: "lists/train_vocals.txt"
  # オプション: RawStems を使うなら train_file_list は消し、こちらを使う
  train_dataset:
    target_stem: "Voc"
    root_directory: "/ABSOLUTE/PATH/TO/STEMS"   # ← 実パスに変更
    apply_augmentation: true
    snr_range: [0.0, 10.0]

  dataloader_params:
    batch_size: 8
    num_workers: 8

# ---- optim ----
optimizer_g:
  name: "adamw"
  lr: 0.0002
  betas: [0.9, 0.95]
  weight_decay: 0.0001

optimizer_d:
  name: "adamw"
  lr: 0.0002
  betas: [0.9, 0.95]
  weight_decay: 0.0001

scheduler:
  name: "cosine"
  warm_up_steps: 5000

# ---- loss（最小）----
loss:
  sisnr: 1.0
  l1_wave: 1.0
  mrstft: { weight: 0.5, windows: [4096,1024,256], hops: [1024,256,64] }
  # CLAP 系は最初は無効（laion-clap 導入後に上げる）
  clap_embed: 0.0
  fad_proxy: 0.0
  # Mixture 再構成（単ステム学習に有効）
  mixture_reconstruct: 0.5
  # GAN
  gan: { type: "hinge", weight: 0.05, fm_weight: 0.05 }

# ---- trainer ----
trainer:
  save_dir: "runs"        # ★ 追加
  max_steps: 400000
  log_every_n_steps: 100
  checkpoint_save_interval: 10000
  devices: [0]
  precision: "bf16-mixed"

# ---- logging ----
logging:
  # TensorBoard
  tensorboard:
    enabled: true

  # Weights & Biases (WandB)
  wandb:
    enabled: false                    # Set to true to enable WandB logging
    project: "msrkit"                 # WandB project name
    entity: null                      # Your WandB username or team (optional)
    name: null                        # Run name (auto-generated if null)
    tags: []                          # Tags for organizing runs, e.g., ["vocals", "experiment1"]
    notes: null                       # Notes about this run (optional)
    log_model: false                  # Set to true to save model checkpoints to WandB